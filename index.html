<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
        <title>Fetch-API-Tutorial-App</title>
    </head>
    <body>
        <button id="getText">Get Text</button>
        <button id="getUsers">Get Users</button>
        <button id="getEndpoint">Get Data From API Endpoint</button>
        <div id="output"></div>
        <script>

            //click listeners for all three buttons
            document.getElementById('getText').addEventListener('click', getText);
            document.getElementById('getUsers').addEventListener('click', getUsers);
            document.getElementById('getEndpoint').addEventListener('click', getEndpoint);
            
            //called when 'Get Text' button is clicked
            function getText() {
                //retrieve text from sample.txt file
                fetch('sample.txt')
                .then((res) => res.text())
                .then((data) => {
                    //place the resulting data in DOM @ element with id of output
                    document.getElementById('output').innerHTML = data;
                })
                //handles errors during retrieval
                .catch((err) => console.log(err))
            }

            //called when 'Get Users' button is clicked
            function getUsers() {
                //retrieve data from users.json file
                fetch('users.json')
                //format response to JSON
                .then((res)=> res.json())
                //plug data into html template
                .then((data)=>{
                    console.log(data);
                    
                    let output = '<h2>Users<h2>';
                    data.forEach((user)=>{
                        output+= `
                        <ul>
                            <li>ID: ${user.id}</li>
                            <li>Name: ${user.name}</li>
                            <li>Email: ${user.email}</li>
                        </ul>
                        `;
                    });
                    //add autofilled template to DOM
                    document.getElementById('output').innerHTML = output;
                })
            }

            //called when 'Get Users' button is clicked
            function getEndpoint() {
                //Test log
                 console.log("listening to #getEndpoint");
                 //retrieve data from API endpoint
                 fetch('http://jsonplaceholder.typicode.com/todos')
                 //format response to JSON
                .then((res)=> res.json())
                //Manipulate data -- plug ids and titles into template with current value of status variable
                .then((data)=>{    
                    
                    let output = '<h2>Todo Items<h2>';
                    //string value dependant on value of task.completed'
                    let status;

                    for (let task of data){
                        if(task.id < 6){
                            //here is where status var is set
                            if(task.completed === true) {
                                this.status="finished";
                            } else {
                                this.status="unfinished";
                            }
                            //here is the template for each iteration
                            output+= `
                            <ul>
                                <li>ID: ${task.id}</li>
                                <li>Title: ${task.title}</li>
                                <li>Status: ${this.status}</li>
                            </ul>
                            `;
                        }
                    }
                    //Paint the DOM with the resulting template
                    document.getElementById('output').innerHTML = output;
                });
            }
        </script>
    </body>
</html>